<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Entradas Movom</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js"></script>

<style>
body { font-family: Arial; background: #E6E6FA; padding: 20px; }
h1 { color: #8A2BE2; text-align: center; }
select, input, button { padding: 8px; margin: 5px 0; border-radius: 5px; }
button { background-color: #00FFFF; border: none; cursor: pointer; }
button:hover { opacity: 0.8; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
th { background-color: #8A2BE2; color: white; }
tr:nth-child(even) { background-color: #E0FFFF; }
tr:nth-child(odd) { background-color: #F8F8FF; }
</style>
</head>
<body>

<h1>ðŸ’œ Entradas Movom ðŸ’œ</h1>

<label>MÃªs:</label>
<select id="mesSelect"></select>
<br><br>

<input type="text" id="nome" placeholder="Nome do aluno">
<input type="text" id="cpf" placeholder="CPF/CNPJ">
<select id="servico">
  <option>Fisioterapia</option>
  <option>Pilates</option>
  <option>Yoga</option>
  <option>Outros</option>
</select>
<input type="number" id="valor" placeholder="Valor">
<select id="pagamento">
  <option>CrÃ©dito</option>
  <option>DÃ©bito</option>
  <option>Dinheiro</option>
  <option>Pix</option>
</select>
<input type="text" id="nf" placeholder="NF (opcional)">
<br>
<button onclick="adicionarPagamento()">Adicionar</button>

<h2>HistÃ³rico</h2>
<table>
<thead>
<tr>
<th>Nome</th><th>CPF/CNPJ</th><th>ServiÃ§o</th><th>Valor</th><th>Pagamento</th><th>NF</th><th>Data</th><th>AÃ§Ãµes</th>
</tr>
</thead>
<tbody id="tabelaBody"></tbody>
</table>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAiaiPHw98hV9yPt1M8mN-2ZC62TVUG6Lk",
  authDomain: "movomentradas.firebaseapp.com",
  databaseURL: "https://movomentradas-default-rtdb.firebaseio.com",
  projectId: "movomentradas",
  storageBucket: "movomentradas.firebasestorage.app",
  messagingSenderId: "5423221990",
  appId: "1:5423221990:web:29a72ef5e6cad1e3afff27"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let mesAtual;

// Preencher select de meses
document.addEventListener("DOMContentLoaded", () => {
  const meses = ["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  const mesSelect = document.getElementById("mesSelect");

  meses.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m;
    opt.textContent = m;
    mesSelect.appendChild(opt);
  });

  mesAtual = meses[new Date().getMonth()];
  mesSelect.value = mesAtual;

  mesSelect.addEventListener("change", () => {
    mesAtual = mesSelect.value;
    carregarHistorico();
  });

  carregarHistorico();
});

function getDbRef() { return db.ref('pagamentos/' + mesAtual); }

function adicionarPagamento() {
  const nome = document.getElementById("nome").value.trim();
  const cpf = document.getElementById("cpf").value.trim();
  const valor = parseFloat(document.getElementById("valor").value);
  const servico = document.getElementById("servico").value;
  const pagamento = document.getElementById("pagamento").value;
  const nf = document.getElementById("nf").value.trim();
  const data = new Date().toLocaleString("pt-BR");

  if(!nome || !cpf || !valor) { alert("Preencha todos os campos!"); return; }

  getDbRef().push({nome, cpf, servico, valor, pagamento, nf, data});

  document.getElementById("nome").value = "";
  document.getElementById("cpf").value = "";
  document.getElementById("valor").value = "";
  document.getElementById("nf").value = "";
}

function apagarIndividual(key) {
  db.ref('pagamentos/' + mesAtual + '/' + key).remove();
}

function carregarHistorico() {
  getDbRef().on('value', snapshot => {
    const tabelaBody = document.getElementById("tabelaBody");
    tabelaBody.innerHTML = "";
    const data = snapshot.val();

    if(data){
      Object.entries(data).forEach(([key,p]) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.nome}</td>
          <td>${p.cpf}</td>
          <td>${p.servico}</td>
          <td>R$ ${p.valor.toFixed(2)}</td>
          <td>${p.pagamento}</td>
          <td>${p.nf || ""}</td>
          <td>${p.data}</td>
          <td><button onclick="apagarIndividual('${key}')">Excluir</button></td>
        `;
        tabelaBody.appendChild(tr);
      });
    }
  });
}
</script>

</body>
</html>


