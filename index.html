<<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Entradas Movom</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #E6E6FA;
        color: #333;
        padding: 20px;
    }
    h1 { color: #8A2BE2; text-align: center; }
    h2 { color: #8A2BE2; margin-top: 30px; }
    select, input, button {
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 14px;
    }
    button {
        background-color: #00FFFF;
        color: #000;
        cursor: pointer;
        border: none;
        font-weight: bold;
        transition: 0.3s;
    }
    button:hover { opacity: 0.8; }
    .card {
        background-color: #F0F8FF;
        border: 1px solid #8A2BE2;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
    }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #8A2BE2; color: white; }
    tr:nth-child(even) { background-color: #E0FFFF; }
    tr:nth-child(odd) { background-color: #F8F8FF; }
    .total { font-size: 18px; font-weight: bold; color: #8A2BE2; margin-top: 10px; }
    .btn-danger { background-color: #FF69B4; color: #fff; }
    canvas { margin-top: 20px; background-color: #FFF; border-radius: 10px; padding: 10px; }
</style>
</head>
<body>

<h1>ðŸ’œ Entradas Movom ðŸ’œ</h1>

<div class="card">
    <label>MÃªs:</label>
    <select id="mesSelect"></select>
</div>

<div class="card">
    <h2>Adicionar Pagamento</h2>
    <input type="text" id="nome" placeholder="Nome do aluno">
    <input type="text" id="cpf" placeholder="CPF/CNPJ">
    <select id="servico">
        <option>Fisioterapia</option>
        <option>Pilates</option>
        <option>Yoga</option>
        <option>Outros</option>
    </select>
    <input type="number" id="valor" placeholder="Valor">
    <select id="pagamento">
        <option>CrÃ©dito</option>
        <option>DÃ©bito</option>
        <option>Dinheiro</option>
        <option>Pix</option>
    </select>
    <br>
    <button onclick="adicionarPagamento()">Adicionar</button>
    <button class="btn-danger" onclick="apagarUltimo()">Apagar Ãšltimo</button>
    <button class="btn-danger" onclick="limparMes()">Limpar MÃªs</button>
</div>

<div class="card">
    <h2>HistÃ³rico de Pagamentos</h2>
    <div class="total" id="totalFaturamento">Total do MÃªs: R$ 0</div>
    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>CPF/CNPJ</th>
                <th>ServiÃ§o</th>
                <th>Valor</th>
                <th>Pagamento</th>
            </tr>
        </thead>
        <tbody id="tabelaBody"></tbody>
    </table>
</div>

<div class="card">
    <h2>GrÃ¡fico de Faturamento</h2>
    <canvas id="graficoTotal"></canvas>
    <canvas id="graficoFormaPagamento"></canvas>
</div>

<script>
const meses = ["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
const mesSelect = document.getElementById("mesSelect");
const tabelaBody = document.getElementById("tabelaBody");
const totalFaturamento = document.getElementById("totalFaturamento");

let graficoTotal, graficoFormaPagamento;

meses.forEach((m, i) => {
    const option = document.createElement("option");
    option.value = m;
    option.textContent = m;
    if (i === new Date().getMonth()) option.selected = true;
    mesSelect.appendChild(option);
});

mesSelect.addEventListener("change", carregarHistorico);

function getStorageKey() { return `studio_${mesSelect.value}`; }

function carregarHistorico() {
    tabelaBody.innerHTML = "";
    const data = JSON.parse(localStorage.getItem(getStorageKey()) || "[]");
    let total = 0;
    const formas = {CrÃ©dito:0, DÃ©bito:0, Dinheiro:0, Pix:0};

    data.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${p.nome}</td><td>${p.cpf}</td><td>${p.servico}</td><td>R$ ${parseFloat(p.valor).toFixed(2)}</td><td>${p.pagamento}</td>`;
        tabelaBody.appendChild(tr);
        total += parseFloat(p.valor);
        if(formas[p.pagamento] !== undefined) formas[p.pagamento] += parseFloat(p.valor);
    });

    totalFaturamento.textContent = `Total do MÃªs: R$ ${total.toFixed(2)}`;
    atualizarGraficos(total, formas);
}

function adicionarPagamento() {
    const nome = document.getElementById("nome").value.trim();
    const cpf = document.getElementById("cpf").value.trim();
    const servico = document.getElementById("servico").value;
    const valor = document.getElementById("valor").value;
    const pagamento = document.getElementById("pagamento").value;

    if(!nome || !cpf || !valor) { alert("Preencha todos os campos!"); return; }

    const data = JSON.parse(localStorage.getItem(getStorageKey()) || "[]");
    data.push({nome, cpf, servico, valor, pagamento});
    localStorage.setItem(getStorageKey(), JSON.stringify(data));
    carregarHistorico();

    document.getElementById("nome").value = "";
    document.getElementById("cpf").value = "";
    document.getElementById("valor").value = "";
}

function apagarUltimo() {
    const data = JSON.parse(localStorage.getItem(getStorageKey()) || "[]");
    if(data.length === 0) return alert("Nenhum registro para apagar");
    data.pop();
    localStorage.setItem(getStorageKey(), JSON.stringify(data));
    carregarHistorico();
}

function limparMes() {
    if(confirm("Tem certeza que deseja limpar todos os registros deste mÃªs?")) {
        localStorage.removeItem(getStorageKey());
        carregarHistorico();
    }
}

function atualizarGraficos(total, formas) {
    const ctxTotal = document.getElementById('graficoTotal').getContext('2d');
    const ctxFormas = document.getElementById('graficoFormaPagamento').getContext('2d');

    if(graficoTotal) graficoTotal.destroy();
    if(graficoFormaPagamento) graficoFormaPagamento.destroy();

    graficoTotal = new Chart(ctxTotal, {
        type: 'bar',
        data: {
            labels: [mesSelect.value],
            datasets: [{ label: 'Total do MÃªs (R$)', data: [total], backgroundColor: '#8A2BE2' }]
        },
        options: { responsive:true, plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } }
    });

    graficoFormaPagamento = new Chart(ctxFormas, {
        type: 'pie',
        data: {
            labels: Object.keys(formas),
            datasets: [{
                label: 'Por Forma de Pagamento',
                data: Object.values(formas),
                backgroundColor: ['#00FFFF','#8A2BE2','#FF69B4','#FFD700']
            }]
        },
        options: { responsive:true }
    });
}

// Inicializa
carregarHistorico();
</script>

</body>
</html>
